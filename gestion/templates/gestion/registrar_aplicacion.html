{% extends 'gestion/base.html' %}
{% load static %}

{% block title %}
    {% if aplicacion %}Editar Aplicación{% else %}Registrar Aplicación{% endif %} - CMDB
{% endblock %}

{% block extra_css %}<link rel="stylesheet" href="{% static 'gestion/css/registrar_aplicacion.css' %}">{% endblock %}

{% block extra_nav_buttons %}
    {% include 'gestion/_extra_nav_buttons.html' %}
{% endblock extra_nav_buttons %}

{% block main_class %}main-content-centered{% endblock %}

{% block content %}
    <div class="page-header">
        <h1 class="page-title">
            {% if aplicacion %}Editar Aplicación{% else %}Registrar Nueva Aplicación{% endif %}
        </h1>
    </div>

    <div class="table-container">
        <form method="post" action="{% if aplicacion %}{% url 'gestion:editar_aplicacion' aplicacion.id %}{% else %}{% url 'gestion:registrar_aplicacion' %}{% endif %}">
            {% csrf_token %}

            <div class="registration-form-layout">

                <div class="form-left-column">
                    <div class="form-group">
                        <label for="cod_aplicacion">Código Aplicación</label>
                        <input type="text" id="cod_aplicacion" name="cod_aplicacion" value="{{ aplicacion.cod_aplicacion|default:'' }}" required>
                    </div>
                    <div class="form-group">
                        <label for="nombre_aplicacion">Nombre Aplicación</label>
                        <input type="text" id="nombre_aplicacion" name="nombre_aplicacion" value="{{ aplicacion.nombre_aplicacion|default:'' }}" required>
                    </div>
                    <div class="form-group">
                        <label for="bloque">Bloque</label>
                        <select id="bloque" name="bloque" required>
                            <option value="">Seleccione...</option>
                            {% for b in todos_los_bloques %}
                                <option value="{{ b.id }}" {% if aplicacion.bloque.id == b.id %}selected{% endif %}>{{ b.desc_bloque }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>

                <div class="form-right-column">
                    <div class="form-group">
                        <label for="criticidad">Criticidad</label>
                        <select id="criticidad" name="criticidad" required>
                            <option value="">Seleccione...</option>
                            {% for c in todas_las_criticidades %}
                                <option value="{{ c.id }}" {% if aplicacion.criticidad.id == c.id %}selected{% endif %}>{{ c.desc_criticidad }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="estado">Estado</label>
                        <select id="estado" name="estado" required>
                            <option value="">Seleccione...</option>
                            {% for e in todos_los_estados %}
                                <option value="{{ e.id }}" {% if aplicacion.estado.id == e.id %}selected{% endif %}>{{ e.desc_estado }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="desc_aplicacion">Descripción</label>
                        <textarea id="desc_aplicacion" name="desc_aplicacion" rows="4">{{ aplicacion.desc_aplicacion|default:'' }}</textarea>
                    </div>
                </div>

            </div> <div class="form-actions">
                <button type="submit" class="btn btn-primary">
                    {% if aplicacion %}Actualizar Aplicación{% else %}Guardar Aplicación{% endif %}
                </button>
                {% if not aplicacion %}
                <a href="{% url 'gestion:carga_masiva_aplicaciones' %}" class="btn btn-secondary link-con-spinner">Carga Masiva</a>
                {% endif %}
                <a href="{% url 'gestion:aplicaciones' %}" class="btn btn-secondary link-con-spinner">Cancelar</a>
            </div>

        </form>
    </div>
{% endblock content %}